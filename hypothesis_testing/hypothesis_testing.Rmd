---
title: "Hypothesis testing"
author: "Filip Děchtěrenko"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: html_document
---

```{r setup, code = readLines("D:/Documents/git/exams_vspj/common_chunks.R")}

```


```{r data generation, echo = FALSE}

df_assignmnent <- get_var_desc()
df_vardesc <- df_assignmnent$var_desc %>% unnest(cols = c(data))
text_question <- sample(df_assignmnent$question,1)

n <- sample(c(7,14,21,28,35,42),1)
r <- runif(1,-1,1)

df_currvars <- sample_vars(df_vardesc, nvar = 2)

# generate X,Y data
df_data <- safe_generate_correlated_data(n,r,df_currvars)
mm <- df_data[[df_currvars$name[1]]] 
mm <- mm %>% matrix(nrow = n/6) %>% round()

sigma <- runif(1,df_currvars$sd[1]*0.8, df_currvars$sd[1]*1.2)
is_signif <- sample(0:1,1)
if(is_signif) {
  p_val <- runif(1,0, 0.05)
} else {
  p_val <- runif(1,0.51, 1)
}




test_type <- sample(c("one-sample","two-sample","paired"),1)
if(test_type == "one-sample") {
  test_type_text <- "od teoretické hodnoty"
} else if (test_type == "two-sample") {
  test_type_text <- "mezi dvěma skupinami"
} else {
  test_type_text <- "mezi dvěma opakovanými měřeními téže skupiny."
}


questions <- character()
solutions <- logical()

if(runif(1) < 0.5) {# correct 
  if(is_signif) {
    questions[1] <- "Zamítáme nulovou hypotézu"
    solution[1] <- T
  } else {
    questions[1] <- "Nezamítáme nulovou hypotézu"
    solution[1] <- F
  }
} else {
  if(is_signif) {
    questions[1] <- "Nezamítáme nulovou hypotézu"
    solution[1] <- F
  } else {
    questions[1] <- "Zamítáme nulovou hypotézu"
    solution[1] <- F
  }
}

test_query

qnorm(p_val, )
mean_0 <- rnorm()
interval_range <- sample(c(95,90,99),1)

u <- qnorm(1-(1-interval_range/100)/2) %>% round(2)
s <- sd(mm) %>% round(2)
m <- mean(mm) %>% round(2)
LB <- m-u*s/sqrt(n) %>% round(1)
UB <- m+u*s/sqrt(n) %>% round(1)


```



Question
========
```{r, results='asis'}
cat(eval(parse(text=text_question)))
```

Byli jsme požádáni o zpracování analýzy, zda se hodnoty proměnné '`r df_currvars$name[1]`' na nasbíraném vzorku liší `r test_type_text` . Získali jsme p-hodnotu rovnou `r p_value`. Které z následujících tvrzení platí?

```{r graf,echo = FALSE, warning =F,message=F}
mm %>% knitr::kable()
```

OtestujteSpočítejte interval, ve kterém se nachází s pravděpodobností `r interval_range`% průměr celé populace (konfidenční interval). Horní i dolní hranici intervalu zaokrouhlete na 1 desetinné místo.

Answerlist
----------
* Jaký je dolní limit pro konfidenční interval? 
* Jaký je horní limit pro konfidenční interval? 

Solution
========
Pro výpočet `r interval_range`% intervalu spolehlivosti pro průměr využijeme vzorce :
$$ 
\begin{aligned}
\left[\bar{y} \, - \, u_{1-\frac{\alpha}{2}}\sqrt{\frac{s^2}{n}}, \; 
  \bar{y} \, + \, u_{1-\frac{\alpha}{2}}\sqrt{\frac{s^2}{n}}\right] 
\end{aligned}
$$

kde v tomto případě je $\bar{y}$=`r m`, $u_{1-\frac{\alpha}{2}}$=`r u`, n = `r n` a s = `r s`. Interval tedy je ve tvaru `r sprintf("[%.1f,%.1f]", LB, UB)`

Answerlist
----------
* Dolní limit je $`r LB %>% exams::fmt(digits = 1)   `$.
* Horní limit je $`r UB %>% exams::fmt(digits = 1)   `$.

Meta-information
================
extype: cloze
exclozetype: num|num
exsolution: `r exams::fmt(LB,digits = 1)`|`r exams::fmt(UB,digits = 1)`
exname: confidence_interval
extol: 0.1